<?php
 header("Content-type: text/html; charset=UTF-8"); class Voting{ private $operator_id; private $user_id; public function __construct($operator_id, $user_id) { $this->operator_id = intval($operator_id); $this->user_id = intval($user_id); require 'mysql.php'; } public function voting($vot){ if($this->verificationVoting()){ $vot = intval($vot); $sql = "INSERT INTO ok_voting VALUES({$this->operator_id}, {$this->user_id}, '{$vot}')"; $mysql = Mysql::getInstance(); if($mysql->exec($sql)){ echo 'Ваш голос принят'; exit; } }else{ die('Вы уже голосовали за данного оператора'); } } public function verificationVoting(){ $mysql = Mysql::getInstance(); $sql = "SELECT voting FROM ok_voting WHERE id_user = {$this->user_id} AND id_operator = {$this->operator_id}"; $result = $mysql->query($sql); if($result->rowCount() == 0){ return true; }else return false; } } session_start(); if(isset($_SESSION['ok_user_id']) AND isset($_SESSION['ok_conn_operator'])){ $voting = new Voting($_SESSION['ok_conn_operator'], $_SESSION['ok_user_id']); if(isset($_POST['vot'])){ $voting->voting($_POST['vot']); } }else die('У вас не было диалога с консультантом!'); ?>
