<?php
 require_once 'mysql.php'; class BlackList{ public $user_id = null; public $user_ip = null; public function __construct($user_id) { $this->user_id = intval($user_id); $this->user_ip = $this->ip(); } public function ip(){ $mysql = Mysql::getInstance(); $sql = "SELECT user_ip FROM ok_users WHERE user_id = {$this->user_id}"; $result = $mysql->query($sql); $arr = $result->fetch(PDO::FETCH_ASSOC); return $arr['user_ip']; } public function addInList(){ $add_date = time(); $operator_id = $_SESSION['operator_id']; $mysql = Mysql::getInstance(); $sql = "INSERT INTO ok_blacklist VALUES({$this->user_ip}, {$operator_id}, '{$add_date}')"; $mysql->exec($sql); $this->delUserOp(); $this->updateConUsers($operator_id); $this->delOnline(); } public function delUserOp(){ $mysql = Mysql::getInstance(); $sql = "UPDATE ok_users_chat SET id_operator = 0 WHERE id_user = {$this->user_id}"; $mysql->exec($sql); } public function updateConUsers($operator_id){ $mysql = Mysql::getInstance(); $sql = "UPDATE ok_operators SET operator_connected = operator_connected - 1 WHERE operator_id = {$operator_id}"; $mysql->exec($sql); } public function delOnline(){ $mysql = Mysql::getInstance(); $sql = "DELETE FROM ok_online WHERE user_ip = {$this->user_ip}"; $mysql->exec($sql); $sql = "DELETE FROM ok_moving WHERE user_ip = {$this->user_ip}"; $mysql->exec($sql); $sql = "DELETE FROM ok_autodialog WHERE ip_user = {$this->user_ip}"; $mysql->exec($sql); } public static function getUserIP($user_ip){ $mysql = Mysql::getInstance(); $sql = "SELECT ip_user FROM ok_blacklist WHERE ip_user = {$user_ip}"; $result = $mysql->query($sql); if($result->rowCount() != 0){ exit; } } } ?>
