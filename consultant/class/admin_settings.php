<?php
 session_start(); class AdminSettings { public $admin_file = '../config/admin_config.php'; public $settings_css = '../css/settings.css'; public $settings_js = '../js/settings.js'; public function __construct() { if(!$this->saveAdmin() OR !$this->saveChatSettings()){ $this->message('Ошибка!!! Не удалось сохранить настройки'); }else{ $this->message('Настройки успешно сохранены'); } } public function saveChatSettings() { if(isset($_POST['enable_autodialog'])){ $settings_js = "var enable_autodialog = true;"; }else{ $settings_js = "var enable_autodialog = false;"; } if(isset($_POST['enable_autodialog_page'])){ $settings_js .= "var enable_autodialog_page = true;"; }else{ $settings_js .= "var enable_autodialog_page = false;"; } if(isset($_POST['offlinebutton'])){ $settings_js .= "var offlinebutton = true;"; }else{ $settings_js .= "var offlinebutton = false;"; } if(isset($_POST['choose_qroup'])){ $settings_js .= "var choose_qroup = true;"; }else{ $settings_js .= "var choose_qroup = false;"; } if(isset($_POST['choose_qroup_a'])){ $settings_js .= "var choose_qroup_a = true;"; }else{ $settings_js .= "var choose_qroup_a = false;"; } if(isset($_POST['choose_qroup_name'])){ $settings_js .= "var choose_qroup_name = true;"; }else{ $settings_js .= "var choose_qroup_name = false;"; } if(isset($_POST['form_name'])){ $settings_js .= "var form_name = true;"; }else{ $settings_js .= "var form_name = false;"; } if(isset($_POST['form_tell'])){ $settings_js .= "var form_tell = true;"; }else{ $settings_js .= "var form_tell = false;"; } if(isset($_POST['form_email'])){ $settings_js .= "var form_email = true;"; }else{ $settings_js .= "var form_email = false;"; } $settings_js .= "var ok_autodialog_array = ["; for($i = 0; count($_POST['autodialog_url']) > $i; $i++){ if(trim($_POST['autodialog_url'][$i]) == "") continue; $settings_js .= "{'href':'{$_POST['autodialog_url'][$i]}', 'text':'{$_POST['autodialog_text'][$i]}', 'hide_time': {$_POST['autodialog_pade_hide'][$i]}, 'show_time': {$_POST['autodialog_page_show'][$i]}},"; } $settings_js .= "{}];"; $settings_js .= "var time_system_mess = ["; for($i = 0; count($_POST['ok_not_answer']) > $i; $i++){ if(trim($_POST['ok_not_answer'][$i]) == "") continue; $settings_js .= "{'time':'{$_POST['ok_not_answer_time'][$i]}', 'message':'{$_POST['ok_not_answer'][$i]}'},"; } $settings_js .= "{}];"; $settings_js .= "var ok_chat_color = '{$_POST['chat_color']}' ;"; $settings_js .= "var autodialog_system_name = '{$_POST['autodialog_system_name']}' ;"; $settings_js .= "var ok_autodialog = '{$_POST['autodialog']}' ;"; $settings_js .= "var ok_autodialog_revisit = '{$_POST['autodialog_revisit']}' ;"; $settings_js .= "var autodialog_v_page = '{$_POST['autodialog_v_page']}' ;"; $settings_js .= "var ok_autodialog_time = {$_POST['autodialog_time']} ;"; $settings_js .= "var autodialog_time_hide = {$_POST['autodialog_time_hide']} ;"; $settings_js .= "var ok_noconsult = '{$_POST['nocons']}' ;"; $settings_js .= "var ok_view_form = '{$_POST['ok_view_form']}' ;"; $settings_js .= "var cons_close_chat = '{$_POST['cons_close_chat']}' ;"; $settings_js .= "var ok_position = '{$_POST['chat_position']}' ;"; $settings_js .= "var ok_button_color = '{$_POST['button_color']}' ;"; $settings_css = "#ok_consultant{background: url('../images/noise.png') {$_POST['chat_color']}; repeat}"; switch($_POST['chat_position']) { case "ok_left_center": $settings_css .= "#ok_con_web_chat{left:-340px;top:20%;} #ok_consultant{left: 0px;top: 0%;} #ok_button{right: 0px;top: 50px;} .ok_online_button{width: 30px;height: 110px; border-radius: 0 5px 5px 0; padding: 10px 0 10px 0px; background: url('http://online-consultant/consultant/images/button/online_left.png') {$_POST['button_color']} 0px 0px  no-repeat;} .ok_offline_button{width: 30px;height: 110px;border-radius: 0 5px 5px 0; padding: 10px 0 10px 0px;background: url('http://online-consultant/consultant/images/button/offline_left.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_autodialog_position{position: absolute;width: 19px;height: 18px;top: 30px;left: -19px;background: url('http://online-consultant/consultant/images/button/left.png') no-repeat;}  #ok_autodialog_system{top: 37%;left: 40px;}"; break; case "ok_right_center": $settings_css .= "#ok_con_web_chat{right:-340px;top:20%;} #ok_consultant{right: 0px;top: 0%;} #ok_button{left: 0px;top: 50px;} .ok_online_button{width: 30px;height: 110px; border-radius: 5px 0 0 5px; padding: 10px 0 10px 0px;background: url('http://online-consultant/consultant/images/button/online_right.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_offline_button{width: 30px;height: 110px; border-radius: 5px 0 0 5px; padding: 10px 0 10px 0px;background: url('http://online-consultant/consultant/images/button/offline_right.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_autodialog_position{position: absolute;width: 19px;height: 18px;top: 30px;right: -19px;background: url('http://online-consultant/consultant/images/button/right.png') no-repeat;}  #ok_autodialog_system{top: 37%;right: 40px;}"; break; case "ok_top_center": $settings_css .= "#ok_con_web_chat{top:-356px;left:40%;} #ok_consultant{top: 0px;} #ok_button{bottom: 0;left: 103px;} .ok_online_button{width: 110px;height: 30px; border-radius: 0 0 5px 5px; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/online_top.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_offline_button{width: 110px;height: 30px;border-radius: 0 0 5px 5px; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/offline_top.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_autodialog_position{position: absolute;width: 19px;height: 18px;left: 39px;top: -18px;background: url('http://online-consultant/consultant/images/button/top.png') no-repeat;}  #ok_autodialog_system{left: 45%;top: 40px;}"; break; case "ok_bottom_center": $settings_css .= "#ok_con_web_chat{bottom:-356px;left:40%;} #ok_consultant{bottom: 0px;} #ok_button{left: 103px;top: 0px;} .ok_online_button{width: 110px;height: 30px; border-radius: 5px 5px 0 0; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/online_bottom.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_offline_button{width: 110px;height: 30px;border-radius: 5px 5px 0 0; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/offline_bottom.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_autodialog_position{position: absolute;width: 19px;height: 18px;left: 39px;bottom: -18px;background: url('http://online-consultant/consultant/images/button/bottom.png') no-repeat;}  #ok_autodialog_system{left: 45%;bottom: 40px;}"; break; case "ok_bottom_right": $settings_css .= "#ok_con_web_chat{bottom:-356px;right:0;width:342px;} #ok_consultant{bottom: 0px;} #ok_button{right: 103px;top: 0px;} .ok_online_button{width: 110px;height: 30px; border-radius: 5px 5px 0 0; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/online_bottom.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_offline_button{width: 110px;height: 30px;border-radius: 5px 5px 0 0; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/offline_bottom.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_autodialog_position{position: absolute;width: 19px;height: 18px;right: 173px;bottom: -18px;background: url('http://online-consultant/consultant/images/button/bottom.png') no-repeat;}  #ok_autodialog_system{right: 30px;bottom: 40px;}"; break; case "ok_bottom_left": $settings_css .= "#ok_con_web_chat{bottom:-356px;left:0;width:342px;} #ok_consultant{bottom: 0px;} #ok_button{left: 103px;top:0px;} .ok_online_button{width: 110px;height: 30px; border-radius: 5px 5px 0 0; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/online_bottom.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_offline_button{width: 110px;height: 30px;border-radius: 5px 5px 0 0; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/offline_bottom.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_autodialog_position{position: absolute;width: 19px;height: 18px;left: 30px;bottom: -18px;background: url('http://online-consultant/consultant/images/button/bottom.png') no-repeat;}  #ok_autodialog_system{left: 81px;bottom: 40px;}"; break; case "ok_top_left": $settings_css .= "#ok_con_web_chat{top:-356px;left:0%;width:342px;} #ok_consultant{top: 0px;} #ok_button{bottom: 0;left: 103px;} .ok_online_button{width: 110px;height: 30px; border-radius: 0 0 5px 5px; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/online_top.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_offline_button{width: 110px;height: 30px;border-radius: 0 0 5px 5px; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/offline_top.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_autodialog_position{position: absolute;width: 19px;height: 18px;left: 30px;top: -18px;background: url('http://online-consultant/consultant/images/button/top.png') no-repeat;}  #ok_autodialog_system{left: 81px;top: 40px;}"; break; case "ok_top_right": $settings_css .= "#ok_con_web_chat{top:-356px;right:0%;width:342px;} #ok_consultant{top: 0px;} #ok_button{bottom: 0;right: 103px;} .ok_online_button{width: 110px;height: 30px; border-radius: 0 0 5px 5px; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/online_top.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_offline_button{width: 110px;height: 30px;border-radius: 0 0 5px 5px; padding: 0px 10px 0px 10px;background: url('http://online-consultant/consultant/images/button/offline_top.png') {$_POST['button_color']} 0px 0px no-repeat;} .ok_autodialog_position{position: absolute;width: 19px;height: 18px;right: 173px;top: -18px;background: url('http://online-consultant/consultant/images/button/top.png') no-repeat;}  #ok_autodialog_system{right: 30px;top: 40px;}"; break; } if(!file_put_contents($this->settings_js, $settings_js)){ return false; }else{ if(!file_put_contents($this->settings_css, $settings_css)){ return false; }else{ return true; } } } public function saveAdmin() { $data = '<?php define("ADMIN_LOGIN", "'.$_POST["admin_login"].'"); define("ADMIN_PASSWORD", "'.$_POST['admin_password'].'"); define("OFFLINE_EMAIL", "'.$_POST['offlin_email'].'");'; if(!file_put_contents($this->admin_file, $data)){ return false; }else{ return true; } } public function message($message) { $_SESSION['messages'] = $message; header('Location: http://online-consultant/consultant/index.php'); exit; } } if(isset($_SESSION['who']) AND $_SESSION['who'] == "admin"){ $obj = new AdminSettings(); }else{ header('Location: http://online-consultant/consultant/admin.php'); exit; } ?>
