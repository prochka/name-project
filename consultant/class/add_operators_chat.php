<?php
 class addOperatorsChat{ public function __construct(){ require 'mysql.php'; } public function addMess($message, $operator_id){ $mysql = Mysql::getInstance(); $message = $this->url_to_link($message); $message = $mysql->quote($message); $wr_date = time(); $sql = "INSERT INTO ok_operators_chat VALUES(NULL, {$operator_id}, '{$wr_date}', {$message})"; if($mysql->exec($sql)){ echo $mysql->lastInsertId(); exit; } } public function url_to_link($text){ $reg_exUrl = "/(http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?/"; if (preg_match_all($reg_exUrl, $text, $url)) { foreach($url[0] as $v){ $position = strpos($text,' '.$v)+1; $text = substr_replace($text,'', $position, strlen($v)); $text = substr_replace($text,'<a href="'.$v.'" target="_blank">'.$v.'</a>', $position ,0); } return $text; } else { return $text; } } } session_start(); if($_SESSION['who'] == "operator" AND isset($_SESSION['operator_id'])){ if(!empty($_POST['message'])){ $message = strip_tags($_POST['message']); $operator_id = intval($_SESSION['operator_id']); $chat = new addOperatorsChat(); $chat->addMess($message, $operator_id); }else die('Пусто'); }else die('НН'); ?>
