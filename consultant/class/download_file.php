<?php
 if(isset($_GET['file_id'])){ $file_id = intval($_GET['file_id']); include 'mysql.php'; $mysql = Mysql::getInstance(); $sql = "SELECT * FROM ok_files WHERE file_id = {$file_id}"; $result = $mysql->query($sql); if($result->rowCount()){ $file = $result->fetch(PDO::FETCH_ASSOC); if(is_dir('../uploadfile/')){ $upload_dir = '../uploadfile'; }else{ $upload_dir = '../consultant/uploadfile'; } $fname = $upload_dir.'/'.$file['file_path']; $fsize = $file['file_size']; if(!is_file($fname)) die('Файл удален'); header("HTTP/1.1 200 OK"); header("Connection: close"); header("Content-Type: application/octet-stream"); header("Accept-Ranges: bytes"); header('Content-Disposition: Attachment; filename="'.basename($file['file_name']).'"'); header("Content-Length: ".$fsize); echo file_get_contents($fname); }else{ die('Not file'); } }else{ die('Error!'); } ?>