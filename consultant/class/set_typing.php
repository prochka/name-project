<?php
 class SetTyping{ private $user_id; private $operator_id; public function __construct($user_id, $operator_id){ $this->user_id = intval($user_id); $this->operator_id = intval($operator_id); require 'mysql.php'; } public function typing($to, $from){ $to = intval($to); $mysql = Mysql::getInstance(); if($from == "operator"){ $sql = "UPDATE ok_users_chat SET write_operator = '{$to}' WHERE write_operator != '2' AND id_operator = {$this->operator_id} AND id_user = {$this->user_id}"; $mysql->exec($sql); }elseif($from == "user"){ $sql = "UPDATE ok_users_chat SET write_user = '{$to}' WHERE id_operator = {$this->operator_id} AND id_user = {$this->user_id}"; $mysql->exec($sql); if(trim($_POST['t_mess']) != "") $t_mess = $mysql->quote($_POST['t_mess']); $sql = "INSERT INTO ok_typing (id_user,t_mess) VALUES ({$this->user_id}, $t_mess) ON DUPLICATE KEY UPDATE t_mess = $t_mess"; }else{ exit; } $mysql->exec($sql); exit; } } session_start(); if(isset($_POST['user_id'])){ $set = new SetTyping($_POST['user_id'], $_SESSION['operator_id']); if(isset($_POST['to'])){ $set->typing($_POST['to'], "operator"); }else exit; }else{ $set = new SetTyping($_SESSION['ok_user_id'], $_SESSION['ok_conn_operator']); if(isset($_POST['to'])){ $set->typing($_POST['to'], "user"); }else exit; } ?>
