<?php
header("Content-type: text/html; charset=UTF-8"); class GetDialog { public $for_date; public $to_date; public function __construct() { if(!empty($_POST['for_date']) AND !empty($_POST['to_date'])){ $this->for_date = intval(strtotime($_POST['for_date'])) + intval($_POST['in_for_s']); $this->to_date = intval(strtotime($_POST['to_date'])) + intval($_POST['in_to_s']);; } } public function get() { require 'mysql.php'; $mysql = Mysql::getInstance(); $sql = "SELECT * FROM ok_users WHERE user_date >= {$this->for_date} AND user_date <= {$this->to_date}"; $result = $mysql->query($sql); $result_array = $result->fetchAll(2); foreach ($result_array as $key) { $key["user_date"] = date('Y-m-d  H:i', $key["user_date"]); $key['user_ip'] = long2ip($key['user_ip']); echo '<div class="user_dialog" id="'.$key["user_id"].'"><div class="user_dialog_name"><b>Клиент '.$key["user_id"].'</b></div><div class="user_dialog_date"> <b>Дата: </b>'.$key["user_date"].'</div><div class="user_dialog_ip"><b>IP: </b>'.$key['user_ip'].'</div></div>'; } } } session_start(); if(isset($_SESSION['who']) AND $_SESSION['who'] == "admin"){ $dialog = new GetDialog(); $dialog->get(); }else{ die('Нет прав администратора!'); } ?>